<!-- phần body chính bạn có rồi -->
<!-- ... -->
<!-- dưới cùng, thêm script này trước </body> -->
<script>
(function(){
  // cấu hình: URL raw data.json (repo của bạn)
  const RAW_DATA_URL = 'https://raw.githubusercontent.com/tranthanhmanage07-ship-it/tranthanhdz/main/data.json';

  // DOM create: panel quản lý profile
  function $c(tag, props) {
    const el = document.createElement(tag);
    if (props) Object.assign(el, props);
    return el;
  }

  function loadProfilesFromLS() {
    try { return JSON.parse(localStorage.getItem('tran_profiles') || '[]'); }
    catch(e){ return []; }
  }
  function saveProfilesToLS(profiles){
    localStorage.setItem('tran_profiles', JSON.stringify(profiles||[]));
  }

  function buildPanel(){
    const wrapper = $c('div');
    Object.assign(wrapper.style, {
      position:'fixed', left:'12px', bottom:'18px', zIndex:99999,
      width:'320px', maxWidth:'92vw', background:'#0b1220', color:'#fff', padding:'12px',
      borderRadius:'12px', boxShadow:'0 6px 18px rgba(0,0,0,0.5)', fontFamily:'Inter,Arial'
    });

    wrapper.innerHTML = `<h4 style="margin:0 0 8px 0">⚒️ Trần Thành DZ - Profiles</h4>`;

    // form create/edit
    const f = $c('div');
    f.innerHTML = `
      <input id="p_name" placeholder="Tên profile" style="width:100%;padding:8px;border-radius:6px;border:none;margin-bottom:6px">
      <div style="display:flex;gap:6px">
        <input id="p_user" placeholder="Tên tài khoản" style="flex:1;padding:8px;border-radius:6px;border:none">
        <input id="p_pass" placeholder="Mật khẩu" style="flex:1;padding:8px;border-radius:6px;border:none">
      </div>
      <input id="p_withdraw" placeholder="Mật khẩu rút tiền" style="width:100%;padding:8px;border-radius:6px;border:none;margin-top:6px">
      <input id="p_fullname" placeholder="Họ và tên (IN HOA)" style="width:100%;padding:8px;border-radius:6px;border:none;margin-top:6px">
      <div style="display:flex;gap:6px;margin-top:6px">
        <input id="p_account" placeholder="Số tài khoản" style="flex:1;padding:8px;border-radius:6px;border:none">
        <input id="p_branch" placeholder="Chi nhánh / Thành phố" style="flex:1;padding:8px;border-radius:6px;border:none">
      </div>
      <div style="display:flex;gap:6px;margin-top:8px">
        <button id="saveProfile" style="flex:1;padding:8px;border-radius:6px;background:#ef476f;border:none;color:#fff">Lưu profile</button>
        <button id="addProfile" style="flex:1;padding:8px;border-radius:6px;background:#06d6a0;border:none;color:#000">Thêm mới</button>
      </div>
    `;
    wrapper.appendChild(f);

    // danh sách profile
    const list = $c('div'); list.style.marginTop='8px'; wrapper.appendChild(list);

    // export / copy / upload note
    const tools = $c('div'); tools.style.marginTop='8px';
    tools.innerHTML = `
      <div style="display:flex;gap:6px">
        <button id="exportJSON" style="flex:1;padding:8px;border-radius:6px;background:#3b82f6;border:none;color:#fff">Xuất JSON</button>
        <button id="copyJSON" style="flex:1;padding:8px;border-radius:6px;background:#f59e0b;border:none;color:#000">Sao chép</button>
      </div>
      <small style="display:block;margin-top:6px;opacity:.9">Sau khi sửa: vào repo -> edit data.json -> dán JSON vào -> Commit (cập nhật để Tampermonkey lấy)</small>
    `;
    wrapper.appendChild(tools);

    // open sites controls
    const opens = $c('div'); opens.style.marginTop='8px';
    opens.innerHTML = `
      <div style="display:flex;gap:6px">
        <button id="openRegs" style="flex:1;padding:8px;border-radius:6px;background:#10b981;border:none;color:#fff">Mở 5 trang đăng ký</button>
        <button id="openBanks" style="flex:1;padding:8px;border-radius:6px;background:#3b82f6;border:none;color:#fff">Mở bank liên kết</button>
      </div>
      <div style="margin-top:6px;display:flex;gap:6px">
        <input id="openDelay" type="number" value="800" style="flex:1;padding:8px;border-radius:6px;border:none" />
        <select id="selProfile" style="flex:1;padding:8px;border-radius:6px;border:none"></select>
      </div>
    `;
    wrapper.appendChild(opens);

    document.body.appendChild(wrapper);

    // functions fill list & select
    function refreshList(){
      const profiles = loadProfilesFromLS();
      list.innerHTML = '';
      const sel = document.getElementById('selProfile');
      sel.innerHTML = '';
      profiles.forEach((p, idx)=> {
        const row = document.createElement('div');
        row.style.display='flex'; row.style.justifyContent='space-between'; row.style.alignItems='center';
        row.style.padding='6px 0'; row.style.borderBottom='1px solid rgba(255,255,255,0.05)';
        row.innerHTML = `<div style="flex:1"><b>${p.name}</b><br><small style="opacity:.8">${p.user} · ${p.account || ''}</small></div>`;
        const btns = document.createElement('div');
        btns.style.display='flex'; btns.style.gap='6px';
        const use = $c('button', { innerText:'Set', onclick:()=> { selectProfile(idx); } });
        const del = $c('button', { innerText:'X', onclick:()=> { if(confirm('Xóa profile?')) { profiles.splice(idx,1); saveProfilesToLS(profiles); refreshList(); } } });
        Object.assign(use.style, { padding:'6px', borderRadius:'6px', border:'none', background:'#06b6d4', color:'#000'});
        Object.assign(del.style, { padding:'6px', borderRadius:'6px', border:'none', background:'#ef4444', color:'#fff' });
        btns.appendChild(use); btns.appendChild(del);
        row.appendChild(btns);
        list.appendChild(row);

        // add to select
        const opt = document.createElement('option'); opt.value = p.name; opt.innerText = p.name; sel.appendChild(opt);
      });
      if(profiles.length===0){
        list.innerHTML='<small style="opacity:.8">Chưa có profile nào.</small>';
      }
    }

    function selectProfile(i){
      const profiles = loadProfilesFromLS();
      const p = profiles[i];
      if(!p) return alert('Profile không tồn tại');
      // set form inputs
      document.getElementById('p_name').value = p.name||'';
      document.getElementById('p_user').value = p.user||'';
      document.getElementById('p_pass').value = p.pass||'';
      document.getElementById('p_withdraw').value = p.withdraw||'';
      document.getElementById('p_fullname').value = p.fullname||'';
      document.getElementById('p_account').value = p.account||'';
      document.getElementById('p_branch').value = p.branch||'';
    }

    // buttons handlers
    document.getElementById('addProfile').onclick = ()=>{
      // add from form
      const profiles = loadProfilesFromLS();
      const p = {
        name: document.getElementById('p_name').value.trim() || ('profile'+(profiles.length+1)),
        user: document.getElementById('p_user').value.trim(),
        pass: document.getElementById('p_pass').value.trim(),
        withdraw: document.getElementById('p_withdraw').value.trim(),
        fullname: document.getElementById('p_fullname').value.trim(),
        account: document.getElementById('p_account').value.trim(),
        branch: document.getElementById('p_branch').value.trim()
      };
      profiles.push(p);
      saveProfilesToLS(profiles);
      refreshList();
      alert('Đã thêm profile');
    };

    document.getElementById('saveProfile').onclick = ()=>{
      const profiles = loadProfilesFromLS();
      const name = document.getElementById('p_name').value.trim();
      if(!name) return alert('Nhập tên profile');
      // find existing by name
      let idx = profiles.findIndex(x=>x.name===name);
      const p = {
        name: name,
        user: document.getElementById('p_user').value.trim(),
        pass: document.getElementById('p_pass').value.trim(),
        withdraw: document.getElementById('p_withdraw').value.trim(),
        fullname: document.getElementById('p_fullname').value.trim(),
        account: document.getElementById('p_account').value.trim(),
        branch: document.getElementById('p_branch').value.trim()
      };
      if(idx>=0) profiles[idx] = p;
      else profiles.push(p);
      saveProfilesToLS(profiles);
      refreshList();
      alert('Đã lưu profile');
    };

    document.getElementById('exportJSON').onclick = ()=>{
      const profiles = loadProfilesFromLS();
      // export format data.json: { active: "name", profiles: [...] , sites: [...] }
      const payload = {
        active: (profiles[0] && profiles[0].name) || '',
        profiles: profiles,
        sites: [
          { name: "MMOO", reg: "https://m.mmoo.team/", bank: "https://m.mmoo.team/Financial?type=" },
          { name: "TT88", reg: "https://m.1tt88.vip/", bank: "https://m.1tt88.vip/Financial" },
          { name: "789P", reg: "https://m.789p1.vip/", bank: "https://m.789p1.vip/Financial" },
          { name: "GO99", reg: "https://m.1go99.vip/", bank: "https://m.1go99.vip/Financial" },
          { name: "NOHU", reg: "https://m.8nohu.vip/", bank: "https://m.8nohu.vip/Financial" }
        ]
      };
      const json = JSON.stringify(payload, null, 2);
      // show in prompt for copy
      const w = window.open('', '_blank', 'width=600,height=600');
      w.document.write('<pre style="white-space:pre-wrap;">'+json.replace(/</g,'&lt;')+'</pre>');
      alert('Mở cửa sổ chứa JSON — copy nội dung và dán vào data.json trên repo của bạn (GitHub).');
    };

    document.getElementById('copyJSON').onclick = ()=>{
      const profiles = loadProfilesFromLS();
      const payload = { active: (profiles[0] && profiles[0].name) || '', profiles: profiles };
      const json = JSON.stringify(payload, null, 2);
      navigator.clipboard?.writeText(json).then(()=> alert('Đã copy JSON vào clipboard. Dán vào data.json trên repo.'), ()=> alert('Copy thất bại — dùng Xuất JSON'));
    };

    document.getElementById('openRegs').onclick = ()=>{
      const delay = parseInt(document.getElementById('openDelay').value) || 800;
      const sites = [
        'https://m.mmoo.team/',
        'https://m.1tt88.vip/',
        'https://m.789p1.vip/',
        'https://m.1go99.vip/',
        'https://m.8nohu.vip/'
      ];
      let i=0;
      const t=setInterval(()=> {
        if (i>=sites.length) { clearInterval(t); return; }
        window.open(sites[i], '_blank');
        i++;
      }, delay);
    };

    document.getElementById('openBanks').onclick = ()=>{
      const delay = parseInt(document.getElementById('openDelay').value) || 800;
      const sites = [
        'https://m.mmoo.team/Financial?type=',
        'https://m.1tt88.vip/Financial',
        'https://m.789p1.vip/Financial',
        'https://m.1go99.vip/Financial',
        'https://m.8nohu.vip/Financial'
      ];
      let i=0;
      const t=setInterval(()=> {
        if (i>=sites.length) { clearInterval(t); return; }
        window.open(sites[i], '_blank');
        i++;
      }, delay);
    };

    refreshList();
  }

  if (document.readyState === 'complete' || document.readyState === 'interactive') buildPanel();
  else document.addEventListener('DOMContentLoaded', buildPanel);

})();
  </script>
